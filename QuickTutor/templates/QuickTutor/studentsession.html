{% extends 'QuickTutor/base.html' %}

{% block content %}
{% load static %}

<style>
    .coverPhoto {
        background-image: linear-gradient(rgba(79, 94, 99, 0.486), rgba(79, 94, 99, 0.486)),url('https://www.itl.cat/pngfile/big/14-140246_beautiful-nature-wallpaper-background-free-beautiful-nature-background.jpg'); 
        background-repeat: no-repeat; 
        background-size: cover; 
        background-position: center;
        position: fixed;
        width: 100%;
        height: 40vh;
        top: 0;
        left: 0;
        z-index: -1;
    }
</style>

<div class="row">
        
    <div class="col-md-8" style="margin: 8vh 0 0 15vh">
        <div class="coverPhoto"></div>
        <div class="row">
            <img src="https://www.swifthausdesign.com/wp-content/uploads/2014/08/profileIcon-300x300.jpg" style="border-radius: 50%;" alt="Avatar" width="150px">
            <div style="margin-left: 1vh;">
                <a>
                    <h1>{{tutor.firstName}} {{tutor.lastName}}</h1>
                    <h5 style="color:rgb(206, 206, 206)">{{tutor.major}}</h5>
                    <h5 style="color:rgb(206, 206, 206)">{{tutor.year}} Year</h5>
                    <h6 style="color:rgb(206, 206, 206)">{{user.username}}@virginia.edu</h6>
                </a>
            </div>
            
        </div>
        <div class="row text-center" style="margin-top: 2vh">
            <div class="col-3">
                <h1>29</h1>
                Sessions
            </div>
            <div class="col-3">
                <h1>154</h1>
                Requests
            </div>
            <div class="col-3">
                <h1>101</h1>
                Tutors Online
            </div>
        </div>
        
    </div>
    <div class="col-md-2"></div>
    <div class="col-md-2"></div>
    
</div>
<p></p>
<div class="row">
    <div class="col-md-2"></div>
    <div class="col-3">
        <p>
            <h1>STUDENT SESSION</h1>
        </p>
    </div>
    <div class="col-md-2"></div>
</div>
<p></p>
<div class="row" >
    <div class="col-md-2"></div>
    <div class="col-3">
        <p id="waitingStatus">
            Waiting for <b>{{StudentRequest.tutorUsername}}</b> to start the session<span id="dots"></span>
        </p>
        <p id="begunStatus" style="display:none;">
            <!--<b>{{StudentRequest.tutorUsername}}</b> has started the session!-->
            <b>Session has started!</b> 
        </p>
    </div>
    <div id="sessionStartedContainer" class="col-3">
        <div class="container">
            <h1><span id=elapsedTime></span></h1>
        </div>
        <button class="login_button" id="end_session" onclick="endSession()" style="">End Session</button>
    </div>
    <div class="col-md-2"></div>
</div>

{% if user.is_authenticated %}



{% endif %}


<script>
    function transfer(user_id){
        window.location.replace("match/" + user_id);
    }

    function runCheck() {
        $.ajax({
            url: "{% url 'QuickTutor:checkstart' %}", 
            success: function(data) {
                if (data[0].status == 1)
                {
                    $("#begunStatus").show();
                    $("#sessionStartedContainer").show();
                    $("#waitingStatus").hide();
                    runSessionCheck();
                }
                else
                {
                    $("#begunStatus").hide();
                    $("#waitingStatus").show();
                    adjustDots();
                    setTimeout(runCheck, 250);
                }
            },
            complete: function() {
                
            }
        });

        
    }

    function runSessionCheck() {
        $.ajax({
            url: "{% url 'QuickTutor:checksessionstudent' %}", 
            success: function(data) {
                if (data[0].sessionEnded == 1) {
                  endSession();
                }
                else {
                    setTimeout(runSessionCheck, 250); 
                    var date  = new Date(null);
                    date.setSeconds(data[0].elapsedTime);
                    var isoDate = date.toISOString().substr(11,8);
                    $("#elapsedTime").html(isoDate);
                }
            },
            complete: function() {
                
            },
            error: function() {
                setTimeout(runSessionCheck, 250); 
            }
        });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        $("#begunStatus").hide();
        $("#sessionStartedContainer").hide();
        setTimeout(runCheck, 1);
    }, false);

    function adjustDots(){
        div = $("#dots")
        if (div.text() == "") {
            div.text(".");
        }
        else if (div.text() == ".") {
            div.text("..");
        }
        else if (div.text() == "..") {
            div.text("...")
        }
        else {
            div.text("");
        }
    }

    function endSession() {
        window.location.replace("/studentpostsession/" + '{{StudentRequest.header}}' + "/" + '{{StudentRequest.tutorUsername}}');
    }

</script>
{% endblock %}